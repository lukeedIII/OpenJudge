<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 500" width="100%" height="100%">
  <defs>
    <!-- Dark Mode Theme Gradients -->
    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#04060A"/>
      <stop offset="50%" stop-color="#070A12"/>
      <stop offset="100%" stop-color="#020305"/>
    </linearGradient>

    <!-- Glowing Node Filters -->
    <filter id="glow-cyan" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur stdDeviation="4" result="blur" />
      <feMerge><feMergeNode in="blur" /><feMergeNode in="SourceGraphic" /></feMerge>
    </filter>
    <filter id="glow-orange" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur stdDeviation="4" result="blur" />
      <feMerge><feMergeNode in="blur" /><feMergeNode in="SourceGraphic" /></feMerge>
    </filter>
    <filter id="glow-green" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur stdDeviation="4" result="blur" />
      <feMerge><feMergeNode in="blur" /><feMergeNode in="SourceGraphic" /></feMerge>
    </filter>
    <filter id="glow-purple" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur stdDeviation="4" result="blur" />
      <feMerge><feMergeNode in="blur" /><feMergeNode in="SourceGraphic" /></feMerge>
    </filter>
    <filter id="glow-magenta" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur stdDeviation="4" result="blur" />
      <feMerge><feMergeNode in="blur" /><feMergeNode in="SourceGraphic" /></feMerge>
    </filter>

    <!-- Solid Drop Shadow for Panels -->
    <filter id="panel-shadow" x="-5%" y="-5%" width="120%" height="120%">
      <feDropShadow dx="0" dy="12" stdDeviation="16" flood-color="#000000" flood-opacity="0.9"/>
    </filter>

    <!-- Arrow Markers -->
    <marker id="arrow-cyan" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#00f2fe"/>
    </marker>
    <marker id="arrow-orange" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#ff4b2b"/>
    </marker>
    <marker id="arrow-green" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#00ff88"/>
    </marker>
    <marker id="arrow-purple" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#a855f7"/>
    </marker>
    <marker id="arrow-magenta" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#ff0080"/>
    </marker>

    <!-- Background Blueprint Grid -->
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" class="grid-line" stroke="rgba(255,255,255,0.02)" stroke-width="1"/>
    </pattern>
  </defs>

  <!-- ============================================== -->
  <!-- CANVAS LAYER                                   -->
  <!-- ============================================== -->
  <rect width="1200" height="500" fill="url(#bg)"/>
  <rect width="1200" height="500" fill="url(#grid)"/>

  <!-- Top Center Master Title -->
  <text x="600" y="45" font-family="'Inter', Arial, sans-serif" font-weight="900" font-size="20" fill="#ffffff" letter-spacing="6" text-anchor="middle">
    OPENJUDGE V3 ARCHITECTURE
  </text>
  <line x1="450" y1="58" x2="750" y2="58" stroke="#1f2536" stroke-width="2"/>

  <!-- ============================================== -->
  <!-- THE THREE SYMMETRICAL PILLARS                  -->
  <!-- Width: 300px each. Gap: 100px. Margin: 50px.   -->
  <!-- ============================================== -->
  
  <!-- Outer Containers (Y: 85 -> 455) Height: 370 -->
  <rect x="50" y="85" width="300" height="370" rx="16" fill="#0A0F1A" stroke="#1f2536" stroke-width="2" filter="url(#panel-shadow)"/>
  <rect x="450" y="85" width="300" height="370" rx="16" fill="#0A0F1A" stroke="#1f2536" stroke-width="2" filter="url(#panel-shadow)"/>
  <rect x="850" y="85" width="300" height="370" rx="16" fill="#0A0F1A" stroke="#1f2536" stroke-width="2" filter="url(#panel-shadow)"/>

  <!-- Pillar Headers -->
  <text x="200" y="112" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="12" fill="#64748b" letter-spacing="2" text-anchor="middle">CLIENT ENVIRONMENT</text>
  <text x="600" y="112" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="12" fill="#94a3b8" letter-spacing="2" text-anchor="middle">OPENJUDGE ENGINE</text>
  <text x="1000" y="112" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="12" fill="#64748b" letter-spacing="2" text-anchor="middle">LLM GATEWAY</text>

  <!-- ============================================== -->
  <!-- INTERNAL NODES (Perfectly Aligned Y-Centers)   -->
  <!-- Centers exactly at Y=160, Y=270, Y=380         -->
  <!-- Node Height: 60px.                             -->
  <!-- ============================================== -->

  <!-- PILAR 1: LEFT -->
  <!-- N1.1 (Y=160) -->
  <rect x="70" y="130" width="260" height="60" rx="8" fill="#0c111c" stroke="#00f2fe" stroke-width="1.2"/>
  <circle cx="90" cy="160" r="4" fill="#00f2fe" filter="url(#glow-cyan)"/>
  <text x="110" y="156" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="14" fill="#ffffff">Backend Server</text>
  <text x="110" y="174" font-family="'Consolas', monospace" font-size="11" fill="#64748b">Node.js / Python Runtime</text>

  <!-- N1.2 (Y=270) -->
  <rect x="70" y="240" width="260" height="60" rx="8" fill="#0c111c" stroke="#ff4b2b" stroke-width="1.2"/>
  <circle cx="90" cy="270" r="4" fill="#ff4b2b" filter="url(#glow-orange)"/>
  <text x="110" y="266" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="14" fill="#ffffff">Observer UI</text>
  <text x="110" y="284" font-family="'Consolas', monospace" font-size="11" fill="#64748b">React Dashboard</text>

  <!-- N1.3 (Y=380) -->
  <rect x="70" y="350" width="260" height="60" rx="8" fill="#0c111c" stroke="#a855f7" stroke-width="1.2"/>
  <circle cx="90" cy="380" r="4" fill="#a855f7" filter="url(#glow-purple)"/>
  <text x="110" y="376" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="14" fill="#ffffff">Custom SDK Tools</text>
  <text x="110" y="394" font-family="'Consolas', monospace" font-size="11" fill="#64748b">Local Application Logic</text>

  <!-- PILAR 2: CENTER -->
  <!-- N2.1 (Y=160) -->
  <rect x="470" y="130" width="260" height="60" rx="8" fill="#0c111c" stroke="#00f2fe" stroke-width="1.2"/>
  <circle cx="490" cy="160" r="4" fill="#00f2fe" filter="url(#glow-cyan)"/>
  <text x="510" y="156" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="14" fill="#ffffff">FastAPI Data Hub</text>
  <text x="510" y="174" font-family="'Consolas', monospace" font-size="11" fill="#64748b">Async Microservice Endpoints</text>

  <!-- N2.2 (Y=270) -->
  <rect x="470" y="240" width="260" height="60" rx="8" fill="#0c111c" stroke="#00ff88" stroke-width="1.2"/>
  <circle cx="490" cy="270" r="4" fill="#00ff88" filter="url(#glow-green)"/>
  <text x="510" y="266" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="14" fill="#ffffff">Verification Ledger</text>
  <text x="510" y="284" font-family="'Consolas', monospace" font-size="11" fill="#ff4b2b">State Manager &amp; Execution</text>

  <!-- N2.3 (Y=380) -->
  <rect x="470" y="350" width="260" height="60" rx="8" fill="#0c111c" stroke="#a855f7" stroke-width="1.2"/>
  <circle cx="490" cy="380" r="4" fill="#a855f7" filter="url(#glow-purple)"/>
  <text x="510" y="376" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="14" fill="#ffffff">Enterprise BYOT Registry</text>
  <text x="510" y="394" font-family="'Consolas', monospace" font-size="11" fill="#64748b">Dynamic Tool Injection</text>

  <!-- PILAR 3: RIGHT -->
  <!-- N3.1 (Massive Node Y=130 to Y=410, perfectly bounding 160, 270, 380) -->
  <rect x="870" y="130" width="260" height="280" rx="8" fill="#0c111c" stroke="#ff0080" stroke-width="1.2"/>
  
  <circle cx="1000" cy="270" r="50" fill="none" stroke="#ff0080" stroke-width="1.5" stroke-dasharray="8 4" opacity="0.4">
    <animateTransform attributeName="transform" type="rotate" from="0 1000 270" to="360 1000 270" dur="20s" repeatCount="indefinite"/>
  </circle>
  <circle cx="1000" cy="270" r="35" fill="none" stroke="#ff0080" stroke-width="2" filter="url(#glow-magenta)"/>
  <circle cx="1000" cy="270" r="8" fill="#ffffff" filter="url(#glow-magenta)">
    <animate attributeName="opacity" values="0.4; 1; 0.4" dur="2s" repeatCount="indefinite"/>
  </circle>

  <text x="1000" y="156" font-family="'Inter', Arial, sans-serif" font-weight="bold" font-size="16" fill="#ffffff" text-anchor="middle">Any Compatible LLM</text>
  <text x="1000" y="174" font-family="'Consolas', monospace" font-size="11" fill="#64748b" text-anchor="middle">Strict XML Inference Matrix</text>

  <!-- ============================================== -->
  <!-- MATHEMATICALLY PERFECT DATA LANES              -->
  <!-- ============================================== -->

  <!-- Lane 1: POST /execute (Cyan, Y=160, 330 -> 470) -->
  <line x1="330" y1="160" x2="470" y2="160" stroke="#1f2536" stroke-width="2"/>
  <line x1="330" y1="160" x2="460" y2="160" stroke="#00f2fe" stroke-width="2.5" stroke-dasharray="6 4" marker-end="url(#arrow-cyan)">
    <animate attributeName="stroke-dashoffset" values="10;0" dur="0.8s" repeatCount="indefinite"/>
  </line>
  <circle r="3.5" fill="#00f2fe" filter="url(#glow-cyan)">
    <animateMotion dur="1.2s" repeatCount="indefinite" path="M 330 160 L 460 160"/>
  </circle>
  <text x="400" y="150" font-family="'Consolas', monospace" font-size="11" font-weight="bold" fill="#00f2fe" text-anchor="middle" filter="url(#glow-cyan)">POST /execute</text>

  <!-- Lane 2: Dynamic Prompt (Green, Y=160, 730 -> 870) -->
  <line x1="730" y1="160" x2="870" y2="160" stroke="#1f2536" stroke-width="2"/>
  <line x1="730" y1="160" x2="860" y2="160" stroke="#00ff88" stroke-width="3" stroke-dasharray="10 5" marker-end="url(#arrow-green)">
    <animate attributeName="stroke-dashoffset" values="15;0" dur="0.8s" repeatCount="indefinite"/>
  </line>
  <circle r="4" fill="#00ff88" filter="url(#glow-green)">
    <animateMotion dur="1s" repeatCount="indefinite" path="M 730 160 L 860 160"/>
  </circle>
  <text x="800" y="150" font-family="'Consolas', monospace" font-size="11" font-weight="bold" fill="#00ff88" text-anchor="middle" filter="url(#glow-green)">XML Context Prompt</text>

  <!-- Lane 3: Raw XML Output (Magenta, Y=270, 870 -> 730) -->
  <line x1="870" y1="270" x2="730" y2="270" stroke="#1f2536" stroke-width="2"/>
  <line x1="870" y1="270" x2="740" y2="270" stroke="#ff0080" stroke-width="3" stroke-dasharray="2 6" marker-end="url(#arrow-magenta)">
    <animate attributeName="stroke-dashoffset" values="0;8" dur="0.4s" repeatCount="indefinite"/>
  </line>
  <!-- High frequency token stream -->
  <circle r="3" fill="#ff0080" filter="url(#glow-magenta)"><animateMotion dur="0.6s" repeatCount="indefinite" path="M 870 270 L 740 270"/></circle>
  <circle r="3" fill="#ff0080" filter="url(#glow-magenta)"><animateMotion dur="0.6s" begin="0.3s" repeatCount="indefinite" path="M 870 270 L 740 270"/></circle>
  <text x="800" y="260" font-family="'Consolas', monospace" font-size="11" font-weight="bold" fill="#ff0080" text-anchor="middle" filter="url(#glow-magenta)">Raw LLM Generation</text>

  <!-- Lane 4: SSE Stream (Orange, Y=270, 470 -> 330) -->
  <line x1="470" y1="270" x2="330" y2="270" stroke="#1f2536" stroke-width="2"/>
  <!-- Continuous Glowing Pipe -->
  <line x1="470" y1="270" x2="340" y2="270" stroke="#ff4b2b" stroke-width="4" opacity="0.8" marker-end="url(#arrow-orange)" filter="url(#glow-orange)"/>
  <!-- Bright Packets traveling back -->
  <circle r="4" fill="#ffffff" filter="url(#glow-orange)">
    <animateMotion dur="1.5s" repeatCount="indefinite" path="M 470 270 L 340 270"/>
    <animate attributeName="opacity" values="1;0;1" dur="1.5s" repeatCount="indefinite"/>
  </circle>
  <circle r="4" fill="#ffffff" filter="url(#glow-orange)">
    <animateMotion dur="1.5s" begin="0.75s" repeatCount="indefinite" path="M 470 270 L 340 270"/>
    <animate attributeName="opacity" values="1;0;1" dur="1.5s" repeatCount="indefinite"/>
  </circle>
  <text x="400" y="260" font-family="'Consolas', monospace" font-size="11" font-weight="bold" fill="#ff4b2b" text-anchor="middle">SSE JSON Telemetry</text>

  <!-- Lane 5: Inject Tool (Purple, Y=380, 330 -> 470) -->
  <line x1="330" y1="380" x2="470" y2="380" stroke="#1f2536" stroke-width="2"/>
  <line x1="330" y1="380" x2="460" y2="380" stroke="#a855f7" stroke-width="3" stroke-dasharray="8 6" marker-end="url(#arrow-purple)">
    <animate attributeName="stroke-dashoffset" values="14;0" dur="1s" repeatCount="indefinite"/>
  </line>
  <!-- Moving Code Block -->
  <rect x="-4" y="-3" width="8" height="6" rx="2" fill="#ffffff" filter="url(#glow-purple)">
    <animateMotion dur="1.2s" repeatCount="indefinite" path="M 330 380 L 460 380" rotate="auto"/>
  </rect>
  <text x="400" y="370" font-family="'Consolas', monospace" font-size="11" font-weight="bold" fill="#a855f7" text-anchor="middle" filter="url(#glow-purple)">.register_tool(fn)</text>

  <!-- ============================================== -->
  <!-- INTERNAL ENGINE VERTICAL PIPING                -->
  <!-- Demonstrating Flow inside the Microservice     -->
  <!-- ============================================== -->
  
  <!-- FastAPI -> Ledger (Y=190 -> Y=230) -->
  <line x1="600" y1="190" x2="600" y2="240" stroke="#1f2536" stroke-width="2"/>
  <line x1="600" y1="190" x2="600" y2="230" stroke="#00ff88" stroke-width="2" stroke-dasharray="4 4" marker-end="url(#arrow-green)">
    <animate attributeName="stroke-dashoffset" values="8;0" dur="0.8s" repeatCount="indefinite"/>
  </line>

  <!-- BYOT Registry -> Ledger (Y=350 -> Y=310) -->
  <line x1="600" y1="350" x2="600" y2="300" stroke="#1f2536" stroke-width="2"/>
  <line x1="600" y1="350" x2="600" y2="310" stroke="#a855f7" stroke-width="2" stroke-dasharray="4 4" marker-end="url(#arrow-purple)">
    <animate attributeName="stroke-dashoffset" values="8;0" dur="0.8s" repeatCount="indefinite"/>
  </line>

</svg>
